<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yarnhub AI Assistant</title>
    <style>
        /* --- Color Theme Variables --- */
        :root {
            /* Dark Mode (Default) */
            --yarnhub-green: #00DC8A;
            --send-button-blue: #007BFF;
            --background: #121212;
            --container: #1E1E1E;
            --input: #2F2F2F;
            --header-bg: rgba(0,0,0,0.2);
            --border-color: #333;
            --text-primary: #FFFFFF;
            --text-secondary: #B3B3B3;
            --user-message-text: #121212;
        }

        body.light-mode {
            /* Light Mode Overrides */
            --background: #F4F7F9;
            --container: #FFFFFF;
            --input: #EFEFEF;
            --header-bg: #F4F7F9;
            --border-color: #E0E0E0;
            --text-primary: #121212;
            --text-secondary: #666666;
            --user-message-text: #FFFFFF;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--background);
            color: var(--text-primary);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            padding: 10px;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s;
        }

        /* --- Chat Container --- */
        .chat-container {
            width: 100%;
            max-width: 450px;
            height: 90vh;
            max-height: 700px;
            background: var(--container);
            border-radius: 16px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid var(--border-color);
            transition: background-color 0.3s, border-color 0.3s;
        }

        /* --- Chat Header --- */
        .chat-header {
            padding: 20px;
            background-color: var(--header-bg);
            display: flex;
            align-items: center;
            justify-content: space-between; /* Adjusted for toggle */
            gap: 15px;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.3s, border-color 0.3s;
        }
        
        .header-branding {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
        }

        .header-branding img {
            width: 40px;
            height: 40px;
        }
        
        .header-branding span {
            font-size: 20px;
        }

        .chat-header h1 {
            margin: 0;
            font-size: 20px;
            font-weight: normal;
            color: var(--text-secondary);
        }
        
        #theme-toggle {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
        }

        #theme-toggle svg {
            width: 24px;
            height: 24px;
            fill: var(--text-secondary);
        }

        /* --- Messages Area --- */
        .chat-messages {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message-bubble {
            padding: 12px 18px;
            border-radius: 20px;
            max-width: 80%;
            line-height: 1.6;
            font-size: 15px;
        }

        .user-message {
            background-color: var(--yarnhub-green);
            color: var(--user-message-text); /* Changed to variable */
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }

        .bot-message {
            background-color: var(--input);
            color: var(--text-primary);
            align-self: flex-start;
            border-bottom-left-radius: 5px;
            transition: background-color 0.3s, color 0.3s;
        }
        
        .bot-thinking {
            color: var(--text-secondary);
        }

        /* --- Input Area --- */
        .chat-input-area {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            gap: 10px;
            align-items: center;
            transition: border-color 0.3s;
        }

        #question-input {
            flex-grow: 1;
            padding: 12px 18px;
            border: none;
            border-radius: 20px;
            background-color: var(--input);
            color: var(--text-primary);
            font-size: 15px;
            outline: none;
            transition: background-color 0.3s, color 0.3s;
        }
        
        #question-input::placeholder {
            color: var(--text-secondary);
        }

        #send-button {
            background: var(--send-button-blue); /* Changed to blue */
            border: none;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: transform 0.2s;
        }

        #send-button:hover {
            transform: scale(1.1);
        }
        
        #send-button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }

        #send-button svg {
            width: 24px;
            height: 24px;
        }
    </style>
</head>
<body>
    <!-- This script runs immediately to prevent a "flash" of the wrong theme -->
    <script>
        (function() {
            const theme = localStorage.getItem('theme');
            if (theme === 'light') {
                document.body.classList.add('light-mode');
            }
        })();
    </script>

    <div class="chat-container">
        <div class="chat-header">
            <div class="header-branding">
                <img src="logo.png" alt="Yarnhub Logo">
                <span>Yarnhub</span>
            </div>
            <h1>AI Assistant</h1>
            <button id="theme-toggle">
                <!-- Moon Icon (Default for dark mode) -->
                <svg id="theme-icon" viewBox="0 0 24 24"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
            </button>
        </div>
        <div class="chat-messages" id="messages-area">
            <div class="message-bubble bot-message">
                Hello! I am the Yarnhub AI Assistant. Ask me anything about Brass Rain.
            </div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="question-input" placeholder="Ask a question...">
            <button id="send-button">
                <!-- Send Icon SVG (stroke changed to white) -->
                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M22 2L11 13" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </div>
    </div>

    <script>
        const questionInput = document.getElementById('question-input');
        const sendButton = document.getElementById('send-button');
        const messagesArea = document.getElementById('messages-area');
        const themeToggle = document.getElementById('theme-toggle');
        
        // This will be replaced with your live Render URL after deployment
        const webhookUrl = 'https://yarnhub-backend.onrender.com/webhook';;

        // --- THEME TOGGLE LOGIC ---
        const sunIcon = `<svg id="theme-icon" viewBox="0 0 24 24"><path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364-6.364l-.707-.707M6.343 17.657l-.707-.707m12.728 0l-.707.707M6.343 6.343l-.707.707m6.364-3.678a4 4 0 100 8 4 4 0 000-8z"></path></svg>`;
        const moonIcon = `<svg id="theme-icon" viewBox="0 0 24 24"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>`;

        // Set initial icon on page load
        if (document.body.classList.contains('light-mode')) {
            themeToggle.innerHTML = moonIcon;
        } else {
            themeToggle.innerHTML = sunIcon;
        }
        
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('light-mode');
            if (document.body.classList.contains('light-mode')) {
                localStorage.setItem('theme', 'light');
                themeToggle.innerHTML = moonIcon;
            } else {
                localStorage.setItem('theme', 'dark');
                themeToggle.innerHTML = sunIcon;
            }
        });

        // --- CHAT LOGIC ---
        function addMessage(text, sender) {
            const messageBubble = document.createElement('div');
            messageBubble.classList.add('message-bubble');
            messageBubble.classList.add(sender === 'user' ? 'user-message' : 'bot-message');
            messageBubble.innerText = text;
            messagesArea.appendChild(messageBubble);
            messagesArea.scrollTop = messagesArea.scrollHeight;
            return messageBubble;
        }

        async function askChatbot() {
            const userMessage = questionInput.value.trim();
            if (!userMessage) return;

            addMessage(userMessage, 'user');
            questionInput.value = '';
            sendButton.disabled = true;

            const thinkingIndicator = addMessage('...', 'bot');
            thinkingIndicator.classList.add('bot-thinking');

            try {
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: userMessage })
                });

                if (!response.ok) {
                    throw new Error(`Server error: ${response.status}`);
                }

                const data = await response.json();
                
                thinkingIndicator.innerText = data.reply || 'Sorry, I could not get a response.';
                thinkingIndicator.classList.remove('bot-thinking');

            } catch (error) {
                console.error('Error:', error);
                thinkingIndicator.innerText = 'An error occurred. Please check the terminal.';
                thinkingIndicator.classList.remove('bot-thinking');
            } finally {
                sendButton.disabled = false;
                questionInput.focus();
            }
        }

        sendButton.addEventListener('click', askChatbot);
        questionInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                askChatbot();
            }
        });
    </script>

</body>
</html>
